{% extends "admin/base.html" %}
{% load i18n %}
{% block title %}
	{{ title }} Questions {{ site_title }}
{% endblock %}

{% block branding %}
	<div id="logo" href="/courses" onclick="window.location = '/courses';">
	</div>
{% endblock %}

{% block nav-global %}{% endblock %}

{% block breadcrumbs %}
	<div class="breadcrumbs">
		<a href="{% url 'admin:index' %}">
			{% trans 'Home' %}
		</a>
		&rsaquo;
		<a href="{% url 'courses:course_index' %}">
			{% trans 'Courses' %}
		</a>
		&rsaquo;
		<a href="/courses/{{ course_id }}/">
			{% trans 'Lectures' %}
		</a>
		&rsaquo;
		<a href="/courses/{{ course_id }}/{{ lecture_id }}/">
			{% trans 'Questions' %}
		</a>
	</div>
{% endblock %}

{{ title }}

{% block content %}

	{% load poll_extras %}


    {% block answer %}
    <div class="results">

        <div class="title">
            <div class="question">{{ question.question_text }}</div>
            <div class="description">Choose the best possible answer</div>
        </div>

        <div class="voteWrapper">

            {% for answer in question.answers.filter|voteFilter|slice:":2" %}
                <div class="voteButton">
                    <button type="submit" name="answer" id="answer" value="{{ answer.id }}" class="voteButton">{{ answer.answer_text }}</button>
                </div>
            {% endfor %}

            <div id="voteTimer" class="voteTimer"></div>

        </div>

        <div class="voteSkip"><button type="submit" value="skip" >skip</button></div>

    </div>
    {% endblock answer %}

    <script type="text/javascript">
        $(document).ready(function() {

            // Calculate round end time for the first voting round
            var voteStart = {{ question.vote_start|date:"U" }};
            var roundDuration = {{ question.vote_duration }};
            var round = Math.floor(((new Date().getTime()/1000) - {{ question.vote_start|date:"U" }}) / roundDuration);

            //If the voting has already started, check which round we have to start. Else start countdown
            if ({{ question.vote_start|date:"U" }} < (new Date().getTime()/1000)) {
                //Calculate remaining round time
                time = (voteStart + (round + 1) * roundDuration) - Math.round((new Date().getTime()/1000));
                drawStartRound(time, round);
            } else {
                drawCountdown({{ question.vote_start|date:"U" }} - Math.round((new Date().getTime()/1000)));
            }

            function drawStartRound(time, round) {
                setTimer(time);
                $('.description').html("Choose the best possible answer - voting round = " + round);
            }

            function drawCountdown(time) {
                setTimer(time);
                $('.voteButton').empty();
                $('.voteSkip').empty();
                $('.description').html("Please wait until the voting starts");
            }

            var create_vote = function() {

                if (value != "")
                {
                    var data = { choice:value };
                    var args = { type:"POST", url:"/polls/{{ poll.id }}/ajaxvote/", data:data, complete:create_vote_complete };
                    $.ajax(args);
                }
                else
                {
                    // We should display a helpful error message
                }
                return false;
            };

            //$("#choice").click(create_vote);

            $("button").click(function(){
                var update = $(this).attr("value");

                var currentTime = Math.round(new Date().getTime() / 1000);
                var roundEndTime = Math.round(new Date().getTime() / 1000) + 300;
                var dif = t2-t1;

                //ajax stuff
            });

            function setTimer(duration) {
                $('#voteTimer').pietimer({
                    timerSeconds: duration,
                    color: '#234',
                    fill: false,
                    showPercentage: true,
                    callback: function() {
                        window.location = "";
                    }
                });
            }
        });
    </script>
{% endblock %}
